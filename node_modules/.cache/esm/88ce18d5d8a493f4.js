let Router,asyncMiddleware,countryCurrencyCodeHandler,getCurrencyExchangeRates,convertCurrency;_d8a‍.x([["default",()=>_d8a‍.o]]);_d8a‍.w("express",[["Router",["Router"],function(v){Router=v}]]);_d8a‍.w("../middlewares/asyncMiddleware",[["default",["asyncMiddleware"],function(v){asyncMiddleware=v}]]);_d8a‍.w("../services/countryCurrencyCodeHandler",[["*",null,function(v){countryCurrencyCodeHandler=v}]]);_d8a‍.w("../services/serviceHandler",[["getCurrencyExchangeRates",["getCurrencyExchangeRates"],function(v){getCurrencyExchangeRates=v}],["convertCurrency",["convertCurrency"],function(v){convertCurrency=v}]]);/**
 * Router for currency rate conversions
 */






var router = Router();

/* GET list of currency locations */
router.get(
  '/',
  asyncMiddleware(async (req, res) => {
    const data = await getCurrencyExchangeRates();
    res.json(data);
  })
);

/* POST
/search:
post:
*/
router.post(
  '/search',
  asyncMiddleware(async (req, res) => {
    const { Country, CurrencyCode } = req.body;
    if (Country) {
      const result = await countryCurrencyCodeHandler.getCurrencyNameAndCode(Country);
      return res.json(result);
    }
    if (CurrencyCode) {
      const result = await countryCurrencyCodeHandler.getCountryAndCurrencyCode(CurrencyCode);
      return res.json(result);
    }
    return res.status(400).json({ error: 'please pass in either Country or CurrencyCode' });
  })
);

/* GET
/currency/{currencyFromAmount}/{currencyFromCode}/{currencyToCode}:
 check if 
 /currency/10/EUR/USD
 can be
 /currency?amount=10&from=EUR&to=USD
*/
router.get(
  '/:currencyFromAmount/:currencyFromCode/:currencyToCode',
  asyncMiddleware(async (req, res) => {
    const { currencyFromAmount, currencyFromCode, currencyToCode } = req.params;
    //req.log.info("about to convert to currency")
    if (isNaN(parseFloat(currencyFromAmount))) {
      return res.status(400).json({ error: 'currency from amount should be numeric' });
    }
    const data = await convertCurrency(
      parseFloat(currencyFromAmount.trim()),
      currencyFromCode.trim(),
      currencyToCode.trim(),
      'latest'
    );

    return res.json({ result: data });
  })
);

_d8a‍.d(router);
